# Nginx配置片段 - 拍照打卡静态文件服务
# 将此配置添加到现有的nginx.conf中

# 处理上传照片的静态文件访问
location /uploads/checkin_photos/ {
    alias /var/www/product_system_dev/uploads/checkin_photos/;
    
    # 安全配置
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    add_header X-XSS-Protection "1; mode=block";
    
    # 缓存配置
    expires 30d;
    add_header Cache-Control "public, immutable";
    
    # 压缩配置
    gzip on;
    gzip_types image/jpeg image/png image/webp;
    gzip_min_length 1024;
    
    # 只允许访问图片文件
    location ~* \.(jpg|jpeg|png|webp)$ {
        try_files $uri =404;
    }
    
    # 拒绝其他文件类型
    location ~ \.(php|html|js|css|txt|log)$ {
        deny all;
    }
}

# 处理照片上传的API代理（如果需要）
location /api/upload-checkin-photo {
    # 增加上传大小限制
    client_max_body_size 10M;
    
    # 代理到后端API
    proxy_pass http://localhost:8001;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # 上传超时设置
    proxy_connect_timeout 60s;
    proxy_send_timeout 120s;
    proxy_read_timeout 120s;
}
