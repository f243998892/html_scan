<\!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€šçŸ¥è¯Šæ–­å·¥å…·</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            max-width: 800px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        h1 { color: #333; }
        .info { 
            background: #e3f2fd; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        .error { 
            background: #ffebee; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px;
            border-left: 4px solid #f44336;
        }
        .success { 
            background: #e8f5e9; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        button { 
            padding: 12px 24px; 
            font-size: 16px; 
            margin: 10px 5px;
            border: none;
            border-radius: 5px;
            background: #2196F3;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background: #1976D2;
        }
        button:active {
            transform: scale(0.98);
        }
        #log {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”” é€šçŸ¥åŠŸèƒ½è¯Šæ–­å·¥å…·</h1>
    
    <div class="btn-container">
        <button onclick="checkSupport()">1ï¸âƒ£ æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ</button>
        <button onclick="checkPermission()">2ï¸âƒ£ æ£€æŸ¥å½“å‰æƒé™</button>
        <button onclick="requestPermission()">3ï¸âƒ£ è¯·æ±‚æƒé™</button>
        <button onclick="sendNotification()">4ï¸âƒ£ å‘é€æµ‹è¯•é€šçŸ¥</button>
        <button onclick="clearLog()" style="background: #757575;">æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div id="log"></div>
    
    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            const time = new Date().toLocaleTimeString();
            div.innerHTML = `<strong>[${time}]</strong> ${message}`;
            document.getElementById('log').appendChild(div);
            console.log(`[${time}] ${message}`);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function checkSupport() {
            log('=== å¼€å§‹æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ ===');
            log('æµè§ˆå™¨: ' + navigator.userAgent);
            log('åè®®: ' + window.location.protocol);
            log('ä¸»æœº: ' + window.location.host);
            
            if ('Notification' in window) {
                log('âœ… æµè§ˆå™¨æ”¯æŒé€šçŸ¥åŠŸèƒ½', 'success');
                log('Notificationå¯¹è±¡: ' + typeof Notification);
            } else {
                log('âŒ æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥åŠŸèƒ½', 'error');
                log('å¯èƒ½åŸå› : æµè§ˆå™¨ç‰ˆæœ¬å¤ªæ—§æˆ–ä¸æ”¯æŒè¯¥API', 'error');
            }
            
            if (window.location.protocol \!== 'https:' && window.location.hostname \!== 'localhost') {
                log('âš ï¸ è­¦å‘Š: éHTTPSç¯å¢ƒå¯èƒ½ä¸æ”¯æŒé€šçŸ¥', 'error');
            }
        }
        
        function checkPermission() {
            log('=== æ£€æŸ¥é€šçŸ¥æƒé™ ===');
            
            if (\!('Notification' in window)) {
                log('âŒ æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥åŠŸèƒ½', 'error');
                return;
            }
            
            const permission = Notification.permission;
            log('å½“å‰æƒé™çŠ¶æ€: <strong>' + permission + '</strong>');
            
            if (permission === 'granted') {
                log('âœ… å·²æˆäºˆé€šçŸ¥æƒé™ï¼Œå¯ä»¥å‘é€é€šçŸ¥', 'success');
            } else if (permission === 'denied') {
                log('âŒ é€šçŸ¥æƒé™å·²è¢«æ‹’ç»', 'error');
                log('è§£å†³æ–¹æ³•: åœ¨æµè§ˆå™¨è®¾ç½®ä¸­é‡æ–°å…è®¸é€šçŸ¥æƒé™', 'info');
            } else if (permission === 'default') {
                log('âš ï¸ å°šæœªè¯·æ±‚é€šçŸ¥æƒé™', 'info');
                log('è¯·ç‚¹å‡»"è¯·æ±‚æƒé™"æŒ‰é’®', 'info');
            }
        }
        
        function requestPermission() {
            log('=== è¯·æ±‚é€šçŸ¥æƒé™ ===');
            
            if (\!('Notification' in window)) {
                log('âŒ æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥åŠŸèƒ½', 'error');
                return;
            }
            
            if (Notification.permission === 'denied') {
                log('âŒ æƒé™å·²è¢«æ‹’ç»ï¼Œæ— æ³•å†æ¬¡è¯·æ±‚', 'error');
                log('è¯·æ‰‹åŠ¨åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸é€šçŸ¥', 'error');
                return;
            }
            
            if (Notification.permission === 'granted') {
                log('âœ… æƒé™å·²æˆäºˆï¼Œæ— éœ€å†æ¬¡è¯·æ±‚', 'success');
                return;
            }
            
            log('æ­£åœ¨å¼¹å‡ºæƒé™è¯·æ±‚å¯¹è¯æ¡†...');
            log('è¯·ç‚¹å‡»"å…è®¸"æŒ‰é’®', 'info');
            
            Notification.requestPermission().then(function(permission) {
                log('ç”¨æˆ·é€‰æ‹©: ' + permission);
                
                if (permission === 'granted') {
                    log('âœ… ç”¨æˆ·å·²æˆäºˆé€šçŸ¥æƒé™', 'success');
                    log('ç°åœ¨å¯ä»¥ç‚¹å‡»"å‘é€æµ‹è¯•é€šçŸ¥"äº†', 'success');
                } else if (permission === 'denied') {
                    log('âŒ ç”¨æˆ·æ‹’ç»äº†é€šçŸ¥æƒé™', 'error');
                } else {
                    log('âš ï¸ ç”¨æˆ·å…³é—­äº†æƒé™å¯¹è¯æ¡†', 'info');
                }
            }).catch(function(err) {
                log('âŒ è¯·æ±‚æƒé™æ—¶å‡ºé”™: ' + err.message, 'error');
                log('é”™è¯¯è¯¦æƒ…: ' + err.stack, 'error');
            });
        }
        
        function sendNotification() {
            log('=== å‘é€æµ‹è¯•é€šçŸ¥ ===');
            
            if (\!('Notification' in window)) {
                log('âŒ æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥åŠŸèƒ½', 'error');
                return;
            }
            
            if (Notification.permission \!== 'granted') {
                log('âŒ å°šæœªæˆäºˆé€šçŸ¥æƒé™', 'error');
                log('è¯·å…ˆç‚¹å‡»"è¯·æ±‚æƒé™"æŒ‰é’®', 'error');
                return;
            }
            
            try {
                log('æ­£åœ¨åˆ›å»ºé€šçŸ¥...');
                
                const notification = new Notification('ğŸ‰ æµ‹è¯•æˆåŠŸï¼', {
                    body: 'é€šçŸ¥åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼\nè¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯ã€‚',
                    icon: '/icons/icon-192x192.png',
                    tag: 'test-notification',
                    requireInteraction: false,
                    vibrate: [200, 100, 200],
                    timestamp: Date.now()
                });
                
                log('âœ… é€šçŸ¥å·²å‘é€ï¼è¯·æŸ¥çœ‹ç³»ç»Ÿé€šçŸ¥æ ', 'success');
                log('é€šçŸ¥ä¼šåœ¨5ç§’åè‡ªåŠ¨å…³é—­', 'info');
                
                notification.onclick = function() {
                    log('âœ… ç”¨æˆ·ç‚¹å‡»äº†é€šçŸ¥', 'success');
                    window.focus();
                    notification.close();
                };
                
                notification.onerror = function(err) {
                    log('âŒ é€šçŸ¥æ˜¾ç¤ºå‡ºé”™: ' + err, 'error');
                };
                
                notification.onclose = function() {
                    log('é€šçŸ¥å·²å…³é—­', 'info');
                };
                
                // 5ç§’åè‡ªåŠ¨å…³é—­
                setTimeout(function() {
                    notification.close();
                }, 5000);
                
            } catch (err) {
                log('âŒ åˆ›å»ºé€šçŸ¥æ—¶å‡ºé”™: ' + err.message, 'error');
                log('é”™è¯¯å †æ ˆ: ' + err.stack, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            log('=== è¯Šæ–­å·¥å…·å·²å¯åŠ¨ ===', 'success');
            checkSupport();
            checkPermission();
            log('=== è¯·æŒ‰é¡ºåºç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¿›è¡Œæµ‹è¯• ===', 'info');
        };
    </script>
</body>
</html>
